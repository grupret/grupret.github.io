<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyTorch Lightning Guide: Research to Production | Gurpreet Gandhi</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-text">Gurpreet Gandhi</span>
                <span class="logo-title">Software Architect</span>
            </div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">← Back to Portfolio</a>
                <a href="../projects/neurosymbolic.html" class="nav-link">← Back to Project</a>
                <a href="../index.html#contact" class="nav-link">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Blog Hero -->
    <section class="blog-hero">
        <div class="container">
            <div class="blog-header">
                <h1 class="blog-title">PyTorch Lightning Guide</h1>
                <p class="blog-subtitle">Research to Production Workflows</p>
                <div class="blog-meta">
                    <span class="blog-date"><i class="fas fa-calendar"></i> December 2024</span>
                    <span class="blog-readtime"><i class="fas fa-clock"></i> 12 min read</span>
                    <span class="blog-category"><i class="fas fa-tag"></i> Deep Learning</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Content -->
    <section class="blog-content">
        <div class="container">
            <article class="blog-article">
                <div class="article-content">
                    <h2>Introduction to PyTorch Lightning</h2>
                    <p>
                        PyTorch Lightning is a lightweight wrapper around PyTorch that organizes code 
                        to decouple research from engineering. It provides a structured approach to 
                        building deep learning models while maintaining full flexibility and control.
                    </p>

                    <h2>Core Lightning Module</h2>
                    <div class="code-block">
                        <pre><code>
import pytorch_lightning as pl
import torch
import torch.nn as nn
import torch.nn.functional as F
from torch.utils.data import DataLoader
from torchmetrics import Accuracy

class LitModel(pl.LightningModule):
    def __init__(self, input_size, num_classes, learning_rate=1e-3):
        super().__init__()
        self.save_hyperparameters()
        
        # Model architecture
        self.model = nn.Sequential(
            nn.Linear(input_size, 128),
            nn.ReLU(),
            nn.Dropout(0.3),
            nn.Linear(128, 64),
            nn.ReLU(),
            nn.Linear(64, num_classes)
        )
        
        # Metrics
        self.train_accuracy = Accuracy(task='multiclass', num_classes=num_classes)
        self.val_accuracy = Accuracy(task='multiclass', num_classes=num_classes)
        
    def forward(self, x):
        return self.model(x)
    
    def training_step(self, batch, batch_idx):
        x, y = batch
        logits = self(x)
        loss = F.cross_entropy(logits, y)
        
        # Log metrics
        self.train_accuracy(logits, y)
        self.log('train_loss', loss, on_step=True, on_epoch=True)
        self.log('train_acc', self.train_accuracy, on_step=False, on_epoch=True)
        
        return loss
    
    def validation_step(self, batch, batch_idx):
        x, y = batch
        logits = self(x)
        loss = F.cross_entropy(logits, y)
        
        self.val_accuracy(logits, y)
        self.log('val_loss', loss, on_epoch=True)
        self.log('val_acc', self.val_accuracy, on_epoch=True)
        
    def configure_optimizers(self):
        optimizer = torch.optim.Adam(self.parameters(), lr=self.hparams.learning_rate)
        scheduler = torch.optim.lr_scheduler.ReduceLROnPlateau(optimizer, patience=3)
        
        return {
            'optimizer': optimizer,
            'lr_scheduler': {
                'scheduler': scheduler,
                'monitor': 'val_loss'
            }
        }

# Training
model = LitModel(input_size=784, num_classes=10)
trainer = pl.Trainer(max_epochs=10, gpus=1)
trainer.fit(model, train_dataloader, val_dataloader)
                        </code></pre>
                    </div>

                    <h2>Advanced Features</h2>

                    <h3>Multi-GPU Training</h3>
                    <div class="code-block">
                        <pre><code>
# Distributed Data Parallel
trainer = pl.Trainer(
    accelerator='gpu',
    devices=4,
    strategy='ddp'
)

# Model parallelism for large models
class LargeModel(pl.LightningModule):
    def __init__(self):
        super().__init__()
        self.layer1 = nn.Linear(1000, 10000).to('cuda:0')
        self.layer2 = nn.Linear(10000, 1000).to('cuda:1')
        
    def forward(self, x):
        x = x.to('cuda:0')
        x = F.relu(self.layer1(x))
        x = x.to('cuda:1')
        x = self.layer2(x)
        return x
                        </code></pre>
                    </div>

                    <h3>Callbacks and Logging</h3>
                    <div class="code-block">
                        <pre><code>
from pytorch_lightning.callbacks import ModelCheckpoint, EarlyStopping
from pytorch_lightning.loggers import TensorBoardLogger, WandbLogger

# Callbacks
checkpoint_callback = ModelCheckpoint(
    dirpath='checkpoints/',
    filename='{epoch}-{val_loss:.2f}',
    monitor='val_loss',
    save_top_k=3,
    mode='min'
)

early_stopping = EarlyStopping(
    monitor='val_loss',
    patience=10,
    mode='min'
)

# Loggers
tb_logger = TensorBoardLogger('logs/', name='my_model')
wandb_logger = WandbLogger(project='my_project')

trainer = pl.Trainer(
    callbacks=[checkpoint_callback, early_stopping],
    logger=[tb_logger, wandb_logger],
    max_epochs=100
)
                        </code></pre>
                    </div>

                    <h2>Production Deployment</h2>

                    <h3>Model Serving</h3>
                    <div class="code-block">
                        <pre><code>
# Export to ONNX
model.to_onnx("model.onnx", input_sample, export_params=True)

# TorchScript export
scripted_model = model.to_torchscript()
torch.jit.save(scripted_model, "model.pt")

# Inference API
from fastapi import FastAPI
import torch

app = FastAPI()
model = torch.jit.load("model.pt")

@app.post("/predict")
async def predict(data: dict):
    input_tensor = torch.tensor(data['input'])
    with torch.no_grad():
        prediction = model(input_tensor)
    return {"prediction": prediction.tolist()}
                        </code></pre>
                    </div>

                    <div class="cta-section">
                        <h3>Ready to streamline your PyTorch workflow?</h3>
                        <p>Let's discuss how PyTorch Lightning can accelerate your ML development cycle.</p>
                        <a href="../index.html#contact" class="cta-button">Get Started</a>
                    </div>
                </div>

                <div class="article-sidebar">
                    <div class="sidebar-section">
                        <h3>Related Articles</h3>
                        <ul class="related-links">
                            <li><a href="kubeflow-deep-dive.html">Kubeflow Deep Dive</a></li>
                            <li><a href="tensorflow-architecture.html">TensorFlow Architecture</a></li>
                            <li><a href="neurosymbolic-ai.html">NeuroSymbolic AI</a></li>
                            <li><a href="mlops-best-practices.html">MLOps Best Practices</a></li>
                        </ul>
                    </div>
                </div>
            </article>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Gurpreet Gandhi</h3>
                    <p>Senior Software Architect specializing in enterprise-grade solutions and innovative technology implementations.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../index.html#about">About</a></li>
                        <li><a href="../index.html#projects">Projects</a></li>
                        <li><a href="../index.html#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                        <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
                        <a href="#" aria-label="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Gurpreet Gandhi. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../script.js"></script>
</body>
</html>